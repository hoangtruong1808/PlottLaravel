<?php

namespace Policy\Policy\Filter\Regex;

use Policy\Policy\Filter\RegularExpression;

class PhoneNumber extends RegularExpression
{
    public function __construct($config)
    {
        parent::__construct($config);
        $this->setPattern($this->_getPattern());
    }

    public function setSubject($subject, $options = null)
    {
        $pattern_to_replace = array('/\r/', '/\n/', '/ /', '/\-/', '/\(/', '/\)/', '/ー/', '/－/', '/―/');
        $str_to_replace = array('', '', '', '', '', '', '', '', '');
        parent::setSubject($subject, [$pattern_to_replace, $str_to_replace]);
    }

    /**
     * @return string
     */
    protected function _getPattern()
    {
        $pattern = "011[0-9]{7} | 0123[0-9]{6} | 0124[0-9]{6} | 0125[0-9]{6} | 0126[0-9]{6} | 0133[0-9]{6} | "
            . "0134[0-9]{6} | 0135[0-9]{6} | 0136[0-9]{6} | 0137[0-9]{6} | 01374[0-9]{5} | 01377[0-9]{5} | 0138[0-9]{6} | "
            . "0139[0-9]{6} | 01397[0-9]{5} | 01398[0-9]{5} | 0142[0-9]{6} | 0143[0-9]{6} | 0144[0-9]{6} | 0145[0-9]{6} | "
            . "01457[0-9]{5} | 0146[0-9]{6} | 015[0-9]{7} | 0153[0-9]{6} | 0154[0-9]{6} | 0155[0-9]{6} | 0156[0-9]{6} | "
            . "0157[0-9]{6} | 0158[0-9]{6} | 01587[0-9]{5} | 0162[0-9]{6} | 0163[0-9]{6} | 01634[0-9]{5} | 01635[0-9]{5} | "
            . "0164[0-9]{6} | 0165[0-9]{6} | 01655[0-9]{5} | 01656[0-9]{5} | 01658[0-9]{5} | 0166[0-9]{6} | 0167[0-9]{6} | "
            . "017[0-9]{7} | 0173[0-9]{6} | 0174[0-9]{6} | 0175[0-9]{6} | 0176[0-9]{6} | 0178[0-9]{6} | 0179[0-9]{6} | "
            . "018[0-9]{7} | 0183[0-9]{6} | 0184[0-9]{6} | 0185[0-9]{6} | 0186[0-9]{6} | 0187[0-9]{6} | 019[0-9]{7} | "
            . "0192[0-9]{6} | 0193[0-9]{6} | 0194[0-9]{6} | 0195[0-9]{6} | 0197[0-9]{6} | 0198[0-9]{6} | 022[0-9]{7} | "
            . "0223[0-9]{6} | 0224[0-9]{6} | 0225[0-9]{6} | 0226[0-9]{6} | 0228[0-9]{6} | 0229[0-9]{6} | 023[0-9]{7} | "
            . "0234[0-9]{6} | 0235[0-9]{6} | 0237[0-9]{6} | 0238[0-9]{6} | 024[0-9]{7} | 0241[0-9]{6} | 0242[0-9]{6} | "
            . "0243[0-9]{6} | 0244[0-9]{6} | 0246[0-9]{6} | 0247[0-9]{6} | 0248[0-9]{6} | 025[0-9]{7} | 0254[0-9]{6} | "
            . "0255[0-9]{6} | 0256[0-9]{6} | 0257[0-9]{6} | 0258[0-9]{6} | 0259[0-9]{6} | 026[0-9]{7} | 0261[0-9]{6} | "
            . "0263[0-9]{6} | 0264[0-9]{6} | 0265[0-9]{6} | 0266[0-9]{6} | 0267[0-9]{6} | 0268[0-9]{6} | 0269[0-9]{6} | "
            . "027[0-9]{7} | 0274[0-9]{6} | 0276[0-9]{6} | 0277[0-9]{6} | 0278[0-9]{6} | 0279[0-9]{6} | 028[0-9]{7} | "
            . "0282[0-9]{6} | 0283[0-9]{6} | 0284[0-9]{6} | 0285[0-9]{6} | 0287[0-9]{6} | 0288[0-9]{6} | 0289[0-9]{6} | "
            . "029[0-9]{7} | 0293[0-9]{6} | 0294[0-9]{6} | 0295[0-9]{6} | 0296[0-9]{6} | 0297[0-9]{6} | 0299[0-9]{6} | "
            . "03[0-9]{8} | 04[0-9]{8} | 0428[0-9]{6} | 043[0-9]{7} | 0438[0-9]{6} | 0439[0-9]{6} | 044[0-9]{7} | "
            . "045[0-9]{7} | 046[0-9]{7} | 0463[0-9]{6} | 0465[0-9]{6} | 0466[0-9]{6} | 0467[0-9]{6} | 047[0-9]{7} | "
            . "0475[0-9]{6} | 0476[0-9]{6} | 0478[0-9]{6} | 0479[0-9]{6} | 048[0-9]{7} | 049[0-9]{7} | 0494[0-9]{6} | "
            . "0495[0-9]{6} | 04992[0-9]{5} | 04994[0-9]{5} | 04996[0-9]{5} | 04998[0-9]{5} | 052[0-9]{7} | 053[0-9]{7} | "
            . "0532[0-9]{6} | 0533[0-9]{6} | 0536[0-9]{6} | 0537[0-9]{6} | 0538[0-9]{6} | 0539[0-9]{6} | 054[0-9]{7} | "
            . "0545[0-9]{6} | 0547[0-9]{6} | 0548[0-9]{6} | 055[0-9]{7} | 0551[0-9]{6} | 0553[0-9]{6} | 0554[0-9]{6} | "
            . "0555[0-9]{6} | 0556[0-9]{6} | 0557[0-9]{6} | 0558[0-9]{6} | 0561[0-9]{6} | 0562[0-9]{6} | 0563[0-9]{6} | "
            . "0564[0-9]{6} | 0565[0-9]{6} | 0566[0-9]{6} | 0567[0-9]{6} | 0568[0-9]{6} | 0569[0-9]{6} | 0572[0-9]{6} | "
            . "0573[0-9]{6} | 0574[0-9]{6} | 0575[0-9]{6} | 0576[0-9]{6} | 0577[0-9]{6} | 0578[0-9]{6} | 058[0-9]{7} | "
            . "0584[0-9]{6} | 0585[0-9]{6} | 0586[0-9]{6} | 0587[0-9]{6} | 059[0-9]{7} | 0595[0-9]{6} | 0596[0-9]{6} | "
            . "0597[0-9]{6} | 0598[0-9]{6} | 0599[0-9]{6} | 06[0-9]{8} | 072[0-9]{7} | 0725[0-9]{6} | 073[0-9]{7} | "
            . "0736[0-9]{6} | 0737[0-9]{6} | 0738[0-9]{6} | 0739[0-9]{6} | 0740[0-9]{6} | 0742[0-9]{6} | 0743[0-9]{6} | "
            . "0744[0-9]{6} | 0745[0-9]{6} | 0746[0-9]{6} | 0747[0-9]{6} | 0748[0-9]{6} | 0749[0-9]{6} | 075[0-9]{7} | "
            . "076[0-9]{7} | 0763[0-9]{6} | 0765[0-9]{6} | 0766[0-9]{6} | 0767[0-9]{6} | 0768[0-9]{6} | 077[0-9]{7} | "
            . "0771[0-9]{6} | 0772[0-9]{6} | 0773[0-9]{6} | 0774[0-9]{6} | 0776[0-9]{6} | 0778[0-9]{6} | 0779[0-9]{6} | "
            . "078[0-9]{7} | 079[0-9]{7} | 0791[0-9]{6} | 0794[0-9]{6} | 0795[0-9]{6} | 0796[0-9]{6} | 0797[0-9]{6} | "
            . "0798[0-9]{6} | 0799[0-9]{6} | 082[0-9]{7} | 0823[0-9]{6} | 0824[0-9]{6} | 0826[0-9]{6} | 0827[0-9]{6} | "
            . "0829[0-9]{6} | 083[0-9]{7} | 0834[0-9]{6} | 0835[0-9]{6} | 0836[0-9]{6} | 0837[0-9]{6} | 0838[0-9]{6} | "
            . "08388[0-9]{5} | 08396[0-9]{5} | 084[0-9]{7} | 0846[0-9]{6} | 0847[0-9]{6} | 0848[0-9]{6} | 08512[0-9]{5} | "
            . "08514[0-9]{5} | 0852[0-9]{6} | 0853[0-9]{6} | 0854[0-9]{6} | 0855[0-9]{6} | 0856[0-9]{6} | 0857[0-9]{6} | "
            . "0858[0-9]{6} | 0859[0-9]{6} | 086[0-9]{7} | 0865[0-9]{6} | 0866[0-9]{6} | 0867[0-9]{6} | 0868[0-9]{6} | "
            . "0869[0-9]{6} | 087[0-9]{7} | 0877[0-9]{6} | 0879[0-9]{6} | 088[0-9]{7} | 0883[0-9]{6} | 0884[0-9]{6} | "
            . "0885[0-9]{6} | 0887[0-9]{6} | 0889[0-9]{6} | 089[0-9]{7} | 0893[0-9]{6} | 0894[0-9]{6} | 0895[0-9]{6} | "
            . "0896[0-9]{6} | 0897[0-9]{6} | 0898[0-9]{6} | 092[0-9]{7} | 093[0-9]{7} | 0940[0-9]{6} | 0942[0-9]{6} | "
            . "0943[0-9]{6} | 0944[0-9]{6} | 0946[0-9]{6} | 0947[0-9]{6} | 0948[0-9]{6} | 0949[0-9]{6} | 095[0-9]{7} | "
            . "0952[0-9]{6} | 0954[0-9]{6} | 0955[0-9]{6} | 0956[0-9]{6} | 0957[0-9]{6} | 0959[0-9]{6} | 096[0-9]{7} | "
            . "0965[0-9]{6} | 0966[0-9]{6} | 0967[0-9]{6} | 0968[0-9]{6} | 0969[0-9]{6} | 097[0-9]{7} | 0973[0-9]{6} | "
            . "0974[0-9]{6} | 0977[0-9]{6} | 0978[0-9]{6} | 0979[0-9]{6} | 098[0-9]{7} | 0982[0-9]{6} | 0983[0-9]{6} | "
            . "0984[0-9]{6} | 0985[0-9]{6} | 0986[0-9]{6} | 0987[0-9]{6} | 099[0-9]{7} | 09913[0-9]{5} | 0993[0-9]{6} | "
            . "0994[0-9]{6} | 0995[0-9]{6} | 0996[0-9]{6} | 0997[0-9]{6} | "
            . "(090|080|070)[0-9]{8} | 0120[0-9]{6} | 050[0-9]{8} ";
        return "/$pattern/x";
    }

    public function _getPatternV2()
    {
        //ex: 03012345678
        $phone_number_2_8_not_separator = "\b(?:03|04|06)\d{8}+\b";

        //ex: 09012345678
        $phone_number_3_8_not_separator = "\b(?:090|080|070|050)+\d{8}+\b";

        //ex 0111234567
        $phone_number_3_7_not_separator = "\b(?:011|015|017|018|019|022|024|025|026|027|028|029|043|044|045|046|048|049|052|053|054|055|058|059|072|073|075|076|077|078|079|082|083|084|086|087|088|089|092|093|095|096|097|098|099)+\d{7}+\b";

        //ex: 0123234567
        $phone_number_4_6_not_separator = "\b(?:0123|0124|0125|0126|0133|0134|0135|0136|0137|0138|0139|0142|0143|0144|0145|0146|0153|0154|0155|0156|0157|0158|0162|0163|0164|0165|0166|0167|0173|0174|0175|0176|0178|0179|0183|0184|0185|0186|0187|0192|0193|0194|0195|0197|0198|0223|0224|0225|0226|0228|0229|0234|0235|0237|0238|0241|0242|0243|0244|0246|02470248|0254|0255|0256|0257|0258|0259|0261|0263|0264|0265|0266|0267|0268|0269|0274|0276|0277|0278|0279|0283|0284|0285|0287|0288|0289|0293|0294|0295|0296|0297|0299|0428|0438|0439|0463|0465|0466|0467|0475|0476|0478|0479|0494|0495|0532|0533|0536|0537|0538|0539|0545|0547|0548|0551|0553|0554|0555|0556|0557|0558|0561|0562|0563|0564|0565|0566|0567|0568|0569|0572|0573|0574|0575|0576|0577|0578|0584|0585|0586|0587|0595|0596|0597|0598|0599|0725|0736|0737|0738|0739|0740|0742|0743|0744|0745|0746|0747|0748|0749|0763|0765|0766|0767|0768|0771|0772|0773|0774|0776|0778|0779|0791|0794|0795|0796|0797|0798|0799|0823|0824|0826|0827|0829|0834|0835|0836|0837|0838|0846|0847|0848|0852|0853|0854|0855|0856|0857|0858|0859|0865|0866|0867|0868|0869|0877|0879|0883|0884|0885|0887|0889|0893|0894|0895|0896|0897|0898|0940|0942|0943|0944|0946|0947|0948|0949|0952|0954|0955|0956|0957|0959|0965|0966|0967|0968|0969|0973|0974|0977|0978|0979|0982|0983|0984|0985|0986|0987|0993|0994|0995|0996|0997|0120)+\d{6}+\b";

        //ex: 0137434567
        $phone_number_5_5_not_separator = "\b(?:01374|01377|01397|01398|01457|01587|01634|01635|01655|01656|01658|04992|04994|04996|04998|08388|08396|08512|08514|09913)+\d{5}+\b";

        $phone_number_first_2_4_4 = "\b(?:03|04|06)[\s\-ー－―]\d{4}[\s\-ー－―]\d{4}+\b";
        $phone_number_first_3_4_4 = "\b(?:090|080|070|050)[\s\-ー－―]\d{4}[\s\-ー－―]\d{4}+\b";

        // ex: 011 033 0445
        $phone_number_first_3_3_4 = "\b(?:011|015|017|018|019|022|024|025|026|027|028|029|043|044|045|046|048|049|052|053|054|055|058|059|072|073|075|076|077|078|079|082|083|084|086|087|088|089|092|093|095|096|097|098|099)[\s\-ー－―]\d{3}[\s\-ー－―]\d{4}+\b";

        // ex: 011 0334 044
        $phone_number_first_3_4_3 = "\b(?:011|015|017|018|019|022|024|025|026|027|028|029|043|044|045|046|048|049|052|053|054|055|058|059|072|073|075|076|077|078|079|082|083|084|086|087|088|089|092|093|095|096|097|098|099)[\s\-ー－―]\d{4}[\s\-ー－―]\d{3}+\b";

        // ex: 0123 123 456
        $phone_number_first_4_3_3 = "\b(?:0123|0124|0125|0126|0133|0134|0135|0136|0137|0138|0139|0142|0143|0144|0145|0146|0153|0154|0155|0156|0157|0158|0162|0163|0164|0165|0166|0167|0173|0174|0175|0176|0178|0179|0183|0184|0185|0186|0187|0192|0193|0194|0195|0197|0198|0223|0224|0225|0226|0228|0229|0234|0235|0237|0238|0241|0242|0243|0244|0246|02470248|0254|0255|0256|0257|0258|0259|0261|0263|0264|0265|0266|0267|0268|0269|0274|0276|0277|0278|0279|0283|0284|0285|0287|0288|0289|0293|0294|0295|0296|0297|0299|0428|0438|0439|0463|0465|0466|0467|0475|0476|0478|0479|0494|0495|0532|0533|0536|0537|0538|0539|0545|0547|0548|0551|0553|0554|0555|0556|0557|0558|0561|0562|0563|0564|0565|0566|0567|0568|0569|0572|0573|0574|0575|0576|0577|0578|0584|0585|0586|0587|0595|0596|0597|0598|0599|0725|0736|0737|0738|0739|0740|0742|0743|0744|0745|0746|0747|0748|0749|0763|0765|0766|0767|0768|0771|0772|0773|0774|0776|0778|0779|0791|0794|0795|0796|0797|0798|0799|0823|0824|0826|0827|0829|0834|0835|0836|0837|0838|0846|0847|0848|0852|0853|0854|0855|0856|0857|0858|0859|0865|0866|0867|0868|0869|0877|0879|0883|0884|0885|0887|0889|0893|0894|0895|0896|0897|0898|0940|0942|0943|0944|0946|0947|0948|0949|0952|0954|0955|0956|0957|0959|0965|0966|0967|0968|0969|0973|0974|0977|0978|0979|0982|0983|0984|0985|0986|0987|0993|0994|0995|0996|0997|0120)[\s\-ー－―]\d{3}[\s\-ー－―]\d{3}+\b";

        // ex: 01374 12 345 | 01374ー12ー345 | 01374－12－345 | 01374―12―345 | 01374-12-345
        $phone_number_first_5_2_3 = "\b(?:01374|01377|01397|01398|01457|01587|01634|01635|01655|01656|01658|04992|04994|04996|04998|08388|08396|08512|08514|09913)[\s\-ー－―]\d{2}[\s\-ー－―]\d{3}+\b";

        // ex: 01374 345 12
        $phone_number_first_5_3_2 = "\b(?:01374|01377|01397|01398|01457|01587|01634|01635|01655|01656|01658|04992|04994|04996|04998|08388|08396|08512|08514|09913)[\s\-ー－―]\d{3}[\s\-ー－―]\d{2}+\b";

        // ex: 01374 34512
        $phone_number_first_5_5 = "\b(?:01374|01377|01397|01398|01457|01587|01634|01635|01655|01656|01658|04992|04994|04996|04998|08388|08396|08512|08514|09913)[\s\-ー－―]\d{5}+\b";

        $all = [
            $phone_number_2_8_not_separator,
            $phone_number_3_8_not_separator,
            $phone_number_3_7_not_separator,
            $phone_number_4_6_not_separator,
            $phone_number_5_5_not_separator,
            $phone_number_first_2_4_4,
            $phone_number_first_3_4_4,
            $phone_number_first_3_3_4,
            $phone_number_first_3_4_3,
            $phone_number_first_4_3_3,
            $phone_number_first_5_2_3,
            $phone_number_first_5_3_2,
            $phone_number_first_5_5,
        ];

        $final_pattern = implode($all, '|');
        return "/$final_pattern/x";
    }
}
